(this["webpackJsonpmern-todo-app"]=this["webpackJsonpmern-todo-app"]||[]).push([[0],{56:function(e,t,c){},57:function(e,t,c){"use strict";c.r(t);var a=c(0),n=c.n(a),s=c(24),r=c.n(s),i=c(9),l=c(2),o=c(25),d=c.n(o),j=c(1);const b=Object(a.createContext)(),u=e=>{let{children:t}=e;const[c,n]=Object(a.useState)(null),[s,r]=Object(a.useState)(localStorage.getItem("token")||null),i=d.a.create({baseURL:"/api"});i.interceptors.request.use(e=>(s&&(e.headers.Authorization="Bearer ".concat(s)),e));const l=async(e,t)=>{const{data:c}=await i.post("/auth/login",{email:e,password:t});r(c.token),n(c.user),localStorage.setItem("token",c.token),localStorage.setItem("user",JSON.stringify(c.user))};return Object(a.useEffect)(()=>{const e=localStorage.getItem("user");e&&s&&n(JSON.parse(e))},[s]),Object(j.jsx)(b.Provider,{value:{user:c,token:s,login:l,register:async(e,t,c)=>{await i.post("/auth/register",{username:e,email:t,password:c}),await l(t,c)},logout:()=>{r(null),n(null),localStorage.removeItem("token"),localStorage.removeItem("user")},api:i},children:t})},p=e=>{var t,c;return e?{_id:e._id,content:(null!==(t=null!==(c=e.content)&&void 0!==c?c:e.title)&&void 0!==t?t:"").toString(),completed:"undefined"!==typeof e.completed?e.completed:!!e.done,raw:e,createdAt:e.createdAt}:null};var h=()=>{const{user:e,logout:t,api:c}=Object(a.useContext)(b),[n,s]=Object(a.useState)([]),[r,i]=Object(a.useState)(""),[l,o]=Object(a.useState)(""),[d,u]=Object(a.useState)(new Set);Object(a.useEffect)(()=>{if(!e)return;(async()=>{try{const{data:e}=await c.get("/tasks"),t=Array.isArray(e)?e.map(p):[];s(t)}catch(e){o("Failed to load tasks")}})()},[e,c]);const h=async e=>{const t=e._id;if(t){u(e=>new Set(e).add(t));try{var a,n;const r={title:null!==(a=null===(n=e.raw)||void 0===n?void 0:n.title)&&void 0!==a?a:e.content,done:!e.completed,content:e.content,completed:!e.completed},{data:i}=await c.put("/tasks/".concat(t),r),l=p(i);s(e=>e.map(e=>e._id===t?l:e))}catch(r){o("Failed to update task")}finally{u(e=>{const c=new Set(e);return c.delete(t),c})}}};return e?Object(j.jsxs)("div",{className:"container",children:[Object(j.jsxs)("h2",{children:["Hello, ",e.username," \ud83d\udc4b"]}),Object(j.jsx)("button",{onClick:t,children:"Logout"}),Object(j.jsxs)("form",{onSubmit:async e=>{if(e.preventDefault(),r.trim())try{const e={title:r.trim(),content:r.trim(),done:!1,completed:!1},{data:t}=await c.post("/tasks",e);s(e=>[...e,p(t)]),i("")}catch(t){o("Failed to add task")}},style:{marginTop:"1rem"},children:[Object(j.jsx)("input",{type:"text",value:r,onChange:e=>i(e.target.value),placeholder:"Enter new task",required:!0,style:{width:"100%",padding:".75rem",borderRadius:8,border:"1px solid #d1d5db"}}),Object(j.jsx)("button",{type:"submit",style:{marginTop:12},children:"Add Task"})]}),l&&Object(j.jsx)("p",{style:{color:"red"},children:l}),Object(j.jsx)("ul",{style:{marginTop:"1rem",listStyle:"none",padding:0},children:n.map(e=>Object(j.jsxs)("li",{style:{marginBottom:".75rem",display:"flex",gap:"12px",alignItems:"center",padding:"12px",borderRadius:8,background:"#fff",boxShadow:"0 1px 3px rgba(0,0,0,0.06)"},children:[Object(j.jsx)("input",{type:"checkbox",checked:!!e.completed,onChange:()=>h(e),disabled:d.has(e._id)}),Object(j.jsx)("span",{style:{color:"#111827",fontSize:"1rem",minWidth:200},children:e.content||"<no content>"}),Object(j.jsx)("small",{style:{color:"#6b7280"},children:e.createdAt?new Date(e.createdAt).toLocaleString():""}),Object(j.jsxs)("div",{style:{marginLeft:"auto",display:"flex",gap:8},children:[Object(j.jsx)("button",{onClick:()=>h(e),disabled:d.has(e._id),children:e.completed?"Undo":"Complete"}),Object(j.jsx)("button",{onClick:()=>(async e=>{if(e){u(t=>new Set(t).add(e));try{await c.delete("/tasks/".concat(e)),s(t=>t.filter(t=>t._id!==e))}catch(t){o("Failed to delete task")}finally{u(t=>{const c=new Set(t);return c.delete(e),c})}}})(e._id),disabled:d.has(e._id),children:"Delete"})]})]},e._id))})]}):Object(j.jsxs)("div",{className:"container",children:[Object(j.jsx)("h2",{children:"Welcome to the To-Do App"}),Object(j.jsxs)("p",{children:["Please ",Object(j.jsx)("a",{href:"/login",children:"Login"})," or ",Object(j.jsx)("a",{href:"/register",children:"Register"})," to continue."]})]})};var O=()=>{const{login:e}=Object(a.useContext)(b),t=Object(l.f)(),[c,n]=Object(a.useState)(""),[s,r]=Object(a.useState)(""),[i,o]=Object(a.useState)("");return Object(j.jsxs)("div",{className:"container",children:[Object(j.jsx)("h2",{children:"Login"}),Object(j.jsxs)("form",{onSubmit:async a=>{a.preventDefault();try{await e(c,s),t.push("/")}catch(n){o("Invalid email or password")}},children:[i&&Object(j.jsx)("p",{style:{color:"red"},children:i}),Object(j.jsxs)("div",{children:[Object(j.jsx)("label",{children:"Email:"}),Object(j.jsx)("br",{}),Object(j.jsx)("input",{type:"email",value:c,onChange:e=>n(e.target.value),required:!0})]}),Object(j.jsxs)("div",{children:[Object(j.jsx)("label",{children:"Password:"}),Object(j.jsx)("br",{}),Object(j.jsx)("input",{type:"password",value:s,onChange:e=>r(e.target.value),required:!0})]}),Object(j.jsx)("button",{type:"submit",children:"Login"})]})]})};var x=()=>{const{register:e}=Object(a.useContext)(b),t=Object(l.f)(),[c,n]=Object(a.useState)(""),[s,r]=Object(a.useState)(""),[i,o]=Object(a.useState)(""),[d,u]=Object(a.useState)("");return Object(j.jsxs)("div",{className:"container",children:[Object(j.jsx)("h2",{children:"Register"}),Object(j.jsxs)("form",{onSubmit:async a=>{a.preventDefault();try{await e(c,s,i),t.push("/")}catch(n){u("Registration failed")}},children:[d&&Object(j.jsx)("p",{style:{color:"red"},children:d}),Object(j.jsxs)("div",{children:[Object(j.jsx)("label",{children:"Username:"}),Object(j.jsx)("br",{}),Object(j.jsx)("input",{type:"text",value:c,onChange:e=>n(e.target.value),required:!0})]}),Object(j.jsxs)("div",{children:[Object(j.jsx)("label",{children:"Email:"}),Object(j.jsx)("br",{}),Object(j.jsx)("input",{type:"email",value:s,onChange:e=>r(e.target.value),required:!0})]}),Object(j.jsxs)("div",{children:[Object(j.jsx)("label",{children:"Password:"}),Object(j.jsx)("br",{}),Object(j.jsx)("input",{type:"password",value:i,onChange:e=>o(e.target.value),required:!0})]}),Object(j.jsx)("button",{type:"submit",children:"Register"})]})]})};var m=function(){return Object(j.jsx)(u,{children:Object(j.jsx)(i.a,{children:Object(j.jsx)("div",{className:"container",children:Object(j.jsxs)(l.c,{children:[Object(j.jsx)(l.a,{path:"/",exact:!0,component:h}),Object(j.jsx)(l.a,{path:"/login",component:O}),Object(j.jsx)(l.a,{path:"/register",component:x})]})})})})};c(56);r.a.render(Object(j.jsx)(n.a.StrictMode,{children:Object(j.jsx)(m,{})}),document.getElementById("root"))}},[[57,1,2]]]);
//# sourceMappingURL=main.dd2c5a39.chunk.js.map